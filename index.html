<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‡Ÿé¤Šè£œå……å“æ¨™ç±¤åˆ†æå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4B4BC8'
                    }
                }
            }
        }
    </script>
    <style>
        .markdown-content h3 {
            @apply text-lg font-semibold mt-4 mb-2 text-gray-800 dark:text-gray-200;
        }
        .markdown-content h4 {
            @apply text-base font-medium mt-3 mb-1 text-gray-700 dark:text-gray-300;
        }
        .markdown-content ul {
            @apply list-disc pl-5 space-y-1 text-gray-600 dark:text-gray-400;
        }
        .markdown-content li {
            @apply text-sm leading-relaxed;
        }
        .markdown-content p {
            @apply text-sm text-gray-600 dark:text-gray-400 mb-2;
        }
        .markdown-content strong {
            @apply font-semibold text-gray-800 dark:text-gray-200;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-primary dark:bg-primary-dark text-white shadow-lg">
            <div class="container mx-auto px-4 py-6">
                <h1 class="text-2xl font-bold text-center">ğŸ·ï¸ ç‡Ÿé¤Šè£œå……å“æ¨™ç±¤åˆ†æå™¨</h1>
                <p class="text-center mt-2 text-primary-100">ä¸Šå‚³ç‡Ÿé¤Šæ¨™ç±¤åœ–ç‰‡ï¼Œå³æ™‚ç²å¾—ç‡Ÿé¤Šç´ åŠŸæ•ˆåˆ†æ</p>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8 max-w-4xl">
            <!-- Personal Information Section -->
            <div class="bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg p-6 mb-8 border border-purple-200 dark:border-purple-800">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200 flex items-center">
                    <span class="mr-2">ğŸ‘¤</span>
                    å€‹äººè³‡æ–™ (å¯é¸ï¼Œç”¨æ–¼å€‹äººåŒ–å»ºè­°)
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Gender -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æ€§åˆ¥</label>
                        <select id="gender" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="male">ç”·æ€§</option>
                            <option value="female">å¥³æ€§</option>
                        </select>
                    </div>
                    
                    <!-- Age -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å¹´é½¡</label>
                        <input type="number" id="age" min="1" max="120" placeholder="ä¾‹: 30" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    </div>
                    
                    <!-- Height -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">èº«é«˜ (cm)</label>
                        <input type="number" id="height" min="50" max="250" placeholder="ä¾‹: 170" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    </div>
                    
                    <!-- Weight -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">é«”é‡ (kg)</label>
                        <input type="number" id="weight" min="20" max="300" step="0.1" placeholder="ä¾‹: 65" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    </div>
                    
                    <!-- Activity Level -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æ´»å‹•é‡</label>
                        <select id="activityLevel" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="sedentary">ä¹…å (å¾ˆå°‘é‹å‹•)</option>
                            <option value="light">è¼•åº¦ (æ¯é€±1-3æ¬¡é‹å‹•)</option>
                            <option value="moderate">ä¸­åº¦ (æ¯é€±3-5æ¬¡é‹å‹•)</option>
                            <option value="active">é«˜åº¦ (æ¯é€±6-7æ¬¡é‹å‹•)</option>
                            <option value="very_active">æ¥µé«˜ (æ¯å¤©é‹å‹•æˆ–é«”åŠ›å·¥ä½œ)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Medical Conditions -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">é•·æœŸç—…æ‚£æˆ–å¥åº·ç‹€æ³</label>
                    <textarea id="medicalConditions" rows="3" placeholder="ä¾‹: é«˜è¡€å£“ã€ç³–å°¿ç—…ã€å¿ƒè‡Ÿç—…ã€è…è‡Ÿç—…ã€æ‡·å­•ã€å“ºä¹³ç­‰... (æ²’æœ‰è«‹ç•™ç©º)" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                </div>
                
                <!-- Current Medications -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç›®å‰æœç”¨çš„è—¥ç‰©æˆ–å…¶ä»–è£œå……å“</label>
                    <textarea id="currentMedications" rows="2" placeholder="ä¾‹: é™è¡€å£“è—¥ã€ç¶­ä»–å‘½Dã€é­šæ²¹ç­‰... (æ²’æœ‰è«‹ç•™ç©º)" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                </div>

                <!-- Health Goals -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">æƒ³è¦æ”¹å–„çš„å¥åº·å•é¡Œ (å¯å¤šé¸)</label>
                    
                    <!-- Common Health Issues Checkboxes -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="skinIssues" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">çš®è†šå•é¡Œ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="weightLoss" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">æ¸›è‚¥ç˜¦èº«</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="jointPain" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">é—œç¯€ç–¼ç—›</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="sciatica" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">åéª¨ç¥ç¶“ç—›</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="immunity" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">æå‡å…ç–«åŠ›</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="energy" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">å¢åŠ é«”åŠ›</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="sleep" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">æ”¹å–„ç¡çœ </span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="digestion" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">æ¶ˆåŒ–å•é¡Œ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="memory" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">å¢å¼·è¨˜æ†¶</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="stress" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">èˆ’ç·©å£“åŠ›</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="heartHealth" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">å¿ƒè¡€ç®¡å¥åº·</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="eyeHealth" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">è­·çœ¼æ˜ç›®</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="boneHealth" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">éª¨éª¼å¥åº·</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="hairHealth" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">é ­é«®å¥åº·</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="bloodSugar" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">è¡€ç³–æ§åˆ¶</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="cholesterol" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">è†½å›ºé†‡ç®¡ç†</span>
                        </label>
                    </div>

                    <!-- Custom Health Goals -->
                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">å…¶ä»–å¥åº·ç›®æ¨™</label>
                        <textarea id="customHealthGoals" rows="2" placeholder="ä¾‹: æ”¹å–„æ›´å¹´æœŸç—‡ç‹€ã€ç·©è§£åé ­ç—›ã€æå‡é‹å‹•è¡¨ç¾ç­‰... (æ²’æœ‰è«‹ç•™ç©º)" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                    </div>
                </div>

                <!-- AI Smart Features -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">ğŸ¤– AIæ™ºèƒ½åŠŸèƒ½åå¥½ (å¯é¸ï¼Œæå‡å€‹äººåŒ–é«”é©—)</label>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="aiPersonalized" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ“Š AIå€‹äººåŒ–åˆ†æ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="smartRecommendation" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ§  æ™ºèƒ½ç”¢å“æ¨è–¦å¼•æ“</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="oneClickShopping" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ›’ ä¸€éµè³¼ç‰©æ•´åˆ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="progressTracking" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ“ˆ å¥åº·æˆæ•ˆè¿½è¹¤</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="brandPartnership" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ¤ å“ç‰Œåˆä½œå„ªæƒ </span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" id="premiumMembership" class="w-4 h-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <span class="text-sm text-gray-700 dark:text-gray-300">ğŸ‘‘ é«˜ç´šæœƒå“¡è¨‚é–±</span>
                        </label>
                    </div>

                    <div class="mb-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border border-purple-200 dark:border-purple-800 rounded-md">
                        <p class="text-xs font-medium text-purple-800 dark:text-purple-200 mb-2">ğŸš€ æ™ºèƒ½åŠŸèƒ½èªªæ˜</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-purple-700 dark:text-purple-300">
                            <div>â€¢ ğŸ“Š åŸºæ–¼å¥åº·æ•¸æ“šçš„AIæ·±åº¦åˆ†æ</div>
                            <div>â€¢ ğŸ›’ ç›´æ¥è³¼è²·é€£çµï¼Œäº«å—ç¨å®¶å„ªæƒ </div>
                            <div>â€¢ ğŸ“ˆ è¿½è¹¤ä½¿ç”¨æ•ˆæœå’Œå¥åº·æ”¹å–„é€²åº¦</div>
                            <div>â€¢ ğŸ¤ å“ç‰Œåˆä½œå°ˆå±¬æŠ˜æ‰£å’Œæ–°å“æ¶å…ˆ</div>
                            <div>â€¢ ğŸ‘‘ å°ˆæ¥­ç‡Ÿé¤Šå¸«ç·šä¸Šè«®è©¢æœå‹™</div>
                            <div>â€¢ ğŸ”¬ æœ€æ–°ç‡Ÿé¤Šç§‘å­¸ç ”ç©¶è³‡è¨Šæ¨é€</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Budget -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">ğŸ’° æ¯æœˆç‡Ÿé¤Šè£œå……å“é ç®— (å¯é¸ï¼ŒAIå°‡æ¨è–¦æœ€é©åˆçš„å“ç‰Œçµ„åˆ)</label>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="budget" id="budget1" value="under650" class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="text-sm text-gray-700 dark:text-gray-300">HK$ 650 ä»¥ä¸‹</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="budget" id="budget2" value="650-1000" class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="text-sm text-gray-700 dark:text-gray-300">HK$ 650-1,000</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="budget" id="budget3" value="1000-1500" class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="text-sm text-gray-700 dark:text-gray-300">HK$ 1,000-1,500</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="budget" id="budget4" value="over1500" class="w-4 h-4 text-primary focus:ring-primary border-gray-300">
                            <span class="text-sm text-gray-700 dark:text-gray-300">HK$ 1,500 ä»¥ä¸Š</span>
                        </label>
                    </div>

                    <div class="mb-3 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md">
                        <p class="text-xs font-medium text-green-800 dark:text-green-200 mb-2">ğŸ’° é ç®—å°æ‡‰AIæ¨è–¦æ–¹æ¡ˆ</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-green-700 dark:text-green-300">
                            <div>â€¢ HK$ 650ä»¥ä¸‹ï¼šç¶“æ¿Ÿå¯¦æƒ æ™ºèƒ½çµ„åˆ</div>
                            <div>â€¢ HK$ 650-1,000ï¼šç¶“æ¿Ÿå¯¦æƒ é€²éšAIçµ„åˆ</div>
                            <div>â€¢ HK$ 1,000-1,500ï¼šå„ªè³ªå¹³è¡¡æ™ºèƒ½çµ„åˆ</div>
                            <div>â€¢ HK$ 1,500ä»¥ä¸Šï¼šé ‚ç´šå°ˆæ¥­AIçµ„åˆ</div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">è‡ªè¨‚æ¯æœˆé ç®— (å¯é¸)</label>
                        <input type="number" id="customBudget" min="100" max="5000" placeholder="ä¾‹: 800" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">AIå°‡æ ¹æ“šæ‚¨çš„ç²¾ç¢ºé ç®—æä¾›æœ€ä½³åŒ–æ¨è–¦</p>
                    </div>
                </div>

                <!-- Specific Improvement Targets -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">å…·é«”æ”¹å–„ç›®æ¨™ (å¯é¸ï¼Œæœ‰åŠ©æ–¼æ›´ç²¾æº–çš„å»ºè­°)</label>
                    
                    <!-- Common Target Examples -->
                    <div class="mb-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md">
                        <p class="text-xs font-medium text-blue-800 dark:text-blue-200 mb-2">ğŸ’¡ å»ºè­°æ ¼å¼ï¼šæ™‚é–“ + å…·é«”ç›®æ¨™</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-blue-700 dark:text-blue-300">
                            <div>â€¢ ä¸‰å€‹æœˆå…§æ¸›è‚¥20ç£…</div>
                            <div>â€¢ å…­é€±å…§æ”¹å–„ç¡çœ å“è³ª</div>
                            <div>â€¢ å…©å€‹æœˆå…§è¡€ç³–å›å¾©æ­£å¸¸</div>
                            <div>â€¢ ä¸€å€‹æœˆå…§æ¸›å°‘é—œç¯€ç–¼ç—›</div>
                            <div>â€¢ å››é€±å…§æå‡é«”åŠ›å’Œç²¾ç¥</div>
                            <div>â€¢ ä¸‰å€‹æœˆå…§æ”¹å–„çš®è†šç‹€æ³</div>
                        </div>
                    </div>

                    <!-- Target Input Fields -->
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç›®æ¨™ 1</label>
                            <input type="text" id="target1" placeholder="ä¾‹: ä¸‰å€‹æœˆå…§æ¸›è‚¥20ç£…" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç›®æ¨™ 2</label>
                            <input type="text" id="target2" placeholder="ä¾‹: å…©å€‹æœˆå…§è¡€ç³–å›å¾©æ­£å¸¸æ°´å¹³" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç›®æ¨™ 3</label>
                            <input type="text" id="target3" placeholder="ä¾‹: å…­é€±å…§æ”¹å–„ç¡çœ å“è³ªï¼Œæ¯æ™šç¡è¶³7å°æ™‚" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md">
                    <p class="text-sm text-yellow-800 dark:text-yellow-200">
                        âš ï¸ <strong>é‡è¦æé†’ï¼š</strong>æ­¤åˆ†æåƒ…ä¾›åƒè€ƒï¼Œä¸èƒ½å–ä»£å°ˆæ¥­é†«ç™‚å»ºè­°ã€‚å¦‚æœ‰å¥åº·å•é¡Œæˆ–æ­£åœ¨æœç”¨è—¥ç‰©ï¼Œè«‹è«®è©¢é†«ç”Ÿæˆ–ç‡Ÿé¤Šå¸«ã€‚
                    </p>
                </div>
            </div>

            <!-- Upload Section -->
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">ğŸ“¸ ä¸Šå‚³ç‡Ÿé¤Šæ¨™ç±¤åœ–ç‰‡</h2>
                
                <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center">
                    <input type="file" id="imageInput" accept="image/*" class="hidden">
                    <label for="imageInput" class="cursor-pointer">
                        <div class="space-y-4">
                            <div class="text-4xl">ğŸ“·</div>
                            <div>
                                <p class="text-lg font-medium text-gray-700 dark:text-gray-300">é»æ“Šé¸æ“‡åœ–ç‰‡</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">æ”¯æ´ JPG, PNG, WebP æ ¼å¼</p>
                            </div>
                        </div>
                    </label>
                </div>

                <!-- Preview -->
                <div id="imagePreview" class="mt-4 hidden">
                    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">åœ–ç‰‡é è¦½ï¼š</h3>
                    <img id="previewImg" class="max-w-full h-auto max-h-64 rounded-lg shadow-md mx-auto">
                </div>

                <!-- Action Buttons -->
                <div class="mt-6 space-y-3">
                    <button id="analyzeBtn" class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed hidden">
                        ğŸ” åˆ†æç‡Ÿé¤Šæ¨™ç±¤
                    </button>
                    
                    <button id="recommendBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        ğŸ’Š ç²å–ç‡Ÿé¤Šç”¢å“æ¨è–¦
                    </button>
                    
                    <p class="text-xs text-gray-500 dark:text-gray-400 text-center">
                        ä¸Šå‚³åœ–ç‰‡å¯åˆ†æç¾æœ‰ç”¢å“ï¼Œæˆ–ç›´æ¥ç²å–æ¨è–¦
                    </p>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6 mb-8">
                <div class="flex items-center space-x-3">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                    <span class="text-blue-700 dark:text-blue-300">æ­£åœ¨åˆ†æç‡Ÿé¤Šæ¨™ç±¤...</span>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 mb-8">
                <div class="flex items-center space-x-3 mb-3">
                    <span class="text-red-600 dark:text-red-400">âŒ</span>
                    <span class="text-red-700 dark:text-red-300" id="errorMessage">åˆ†æéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</span>
                </div>
                <div id="errorDetails" class="hidden mt-3 p-3 bg-red-100 dark:bg-red-900/40 rounded text-xs text-red-600 dark:text-red-400 font-mono">
                    <!-- Detailed error info will be shown here -->
                </div>
                <button id="showDebugBtn" class="mt-3 text-sm text-red-600 dark:text-red-400 underline hover:no-underline">
                    é¡¯ç¤ºèª¿è©¦è³‡è¨Š
                </button>
            </div>

            <!-- Debug Info -->
            <div id="debugInfo" class="hidden bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-8">
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">ğŸ”§ èª¿è©¦è³‡è¨Š</h3>
                <div id="debugContent" class="text-xs text-gray-600 dark:text-gray-400 font-mono whitespace-pre-wrap">
                    <!-- Debug info will be shown here -->
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden space-y-6">
                <!-- Product Recommendations -->
                <div id="productRecommendationsSection" class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-6 hidden">
                    <h2 class="text-xl font-semibold mb-4 text-purple-800 dark:text-purple-200 flex items-center">
                        <span class="mr-2">ğŸŒŸ</span>
                        ç‡Ÿé¤Šç”¢å“æ¨è–¦
                    </h2>
                    <div id="productRecommendations" class="markdown-content">
                        <!-- AI recommendations will be inserted here -->
                    </div>
                </div>

                <!-- Personal Suitability -->
                <div id="personalSuitabilitySection" class="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg p-6 hidden">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-800 dark:text-indigo-200 flex items-center">
                        <span class="mr-2">ğŸ¯</span>
                        å€‹äººåŒ–é©ç”¨æ€§è©•ä¼°
                    </h2>
                    <div id="personalSuitability" class="markdown-content">
                        <!-- AI personal analysis will be inserted here -->
                    </div>
                </div>

                <!-- Nutritional Analysis -->
                <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-green-800 dark:text-green-200 flex items-center">
                        <span class="mr-2">ğŸ“Š</span>
                        ç‡Ÿé¤Šæˆåˆ†åˆ†æ
                    </h2>
                    <div id="nutritionalAnalysis" class="markdown-content">
                        <!-- AI analysis will be inserted here -->
                    </div>
                </div>

                <!-- Health Benefits -->
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-blue-800 dark:text-blue-200 flex items-center">
                        <span class="mr-2">ğŸ’Š</span>
                        ç‡Ÿé¤Šç´ åŠŸæ•ˆ
                    </h2>
                    <div id="healthBenefits" class="markdown-content">
                        <!-- AI analysis will be inserted here -->
                    </div>
                </div>

                <!-- Dosage Recommendations -->
                <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-amber-800 dark:text-amber-200 flex items-center">
                        <span class="mr-2">âš–ï¸</span>
                        å»ºè­°æ”å–é‡
                    </h2>
                    <div id="dosageRecommendations" class="markdown-content">
                        <!-- AI analysis will be inserted here -->
                    </div>
                </div>

                <!-- Safety Information -->
                <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4 text-red-800 dark:text-red-200 flex items-center">
                        <span class="mr-2">âš ï¸</span>
                        æ³¨æ„äº‹é …
                    </h2>
                    <div id="safetyInfo" class="markdown-content">
                        <!-- AI analysis will be inserted here -->
                    </div>
                </div>

                <!-- Reset Button -->
                <div class="text-center pt-4">
                    <button id="resetBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200">
                        ğŸ”„ åˆ†ææ–°çš„æ¨™ç±¤
                    </button>
                </div>
            </div>

            <!-- Tips Section -->
            <div class="mt-12 bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200">ğŸ’¡ ä½¿ç”¨å°è²¼å£«</h2>
                <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                    <li>â€¢ ç¢ºä¿æ¨™ç±¤æ–‡å­—æ¸…æ™°å¯è¦‹ï¼Œé¿å…æ¨¡ç³Šæˆ–åå…‰</li>
                    <li>â€¢ å»ºè­°æ‹æ”å®Œæ•´çš„ç‡Ÿé¤Šæˆåˆ†è¡¨</li>
                    <li>â€¢ å¦‚æœæ¨™ç±¤å¾ˆå°ï¼Œå¯ä»¥è¿‘è·é›¢æ‹æ”æé«˜æ¸…æ™°åº¦</li>
                    <li>â€¢ æ”¯æ´ä¸­æ–‡ã€è‹±æ–‡ç­‰å¤šç¨®èªè¨€çš„ç‡Ÿé¤Šæ¨™ç±¤</li>
                </ul>
            </div>
        </main>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // DOM elements
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('resultsSection');
        const resetBtn = document.getElementById('resetBtn');

        let selectedFile = null;
        let debugLog = [];

        // Debug logging function
        function addDebugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            debugLog.push(logEntry);
            if (data) {
                debugLog.push(`    Data: ${JSON.stringify(data)}`);
            }
            console.log(logEntry, data);
            updateDebugDisplay();
        }

        function updateDebugDisplay() {
            const debugContent = document.getElementById('debugContent');
            if (debugContent) {
                debugContent.textContent = debugLog.join('\n');
            }
        }

        // Debug button event
        document.getElementById('showDebugBtn').addEventListener('click', function() {
            const debugInfo = document.getElementById('debugInfo');
            const errorDetails = document.getElementById('errorDetails');
            if (debugInfo.classList.contains('hidden')) {
                debugInfo.classList.remove('hidden');
                errorDetails.classList.remove('hidden');
                this.textContent = 'éš±è—èª¿è©¦è³‡è¨Š';
            } else {
                debugInfo.classList.add('hidden');
                errorDetails.classList.add('hidden');
                this.textContent = 'é¡¯ç¤ºèª¿è©¦è³‡è¨Š';
            }
        });

        // Initialize debug
        addDebugLog('æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•');

        // Image compression function
        function compressImage(file, maxSizeMB = 2, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // Calculate new dimensions
                    let { width, height } = img;
                    const maxDimension = 1200; // Max width or height
                    
                    if (width > height && width > maxDimension) {
                        height = (height * maxDimension) / width;
                        width = maxDimension;
                    } else if (height > maxDimension) {
                        width = (width * maxDimension) / height;
                        height = maxDimension;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob(
                        (blob) => {
                            if (blob) {
                                addDebugLog('åœ–ç‰‡å£“ç¸®å®Œæˆ', {
                                    originalSize: file.size,
                                    compressedSize: blob.size,
                                    compressionRatio: (blob.size / file.size * 100).toFixed(1) + '%'
                                });
                                
                                // Create new file with compressed data
                                const compressedFile = new File([blob], file.name, {
                                    type: 'image/jpeg',
                                    lastModified: Date.now()
                                });
                                resolve(compressedFile);
                            } else {
                                reject(new Error('åœ–ç‰‡å£“ç¸®å¤±æ•—'));
                            }
                        },
                        'image/jpeg',
                        quality
                    );
                };
                
                img.onerror = () => reject(new Error('ç„¡æ³•è¼‰å…¥åœ–ç‰‡é€²è¡Œå£“ç¸®'));
                img.src = URL.createObjectURL(file);
            });
        }

        // Handle file selection
        imageInput.addEventListener('change', async function(e) {
            addDebugLog('æª”æ¡ˆè¼¸å…¥æ¡†è®Šæ›´äº‹ä»¶');
            const file = e.target.files[0];
            if (file) {
                addDebugLog('æª”æ¡ˆå·²é¸æ“‡', {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    lastModified: file.lastModified
                });
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    addDebugLog('æª”æ¡ˆé¡å‹éŒ¯èª¤', { type: file.type });
                    showError('è«‹é¸æ“‡åœ–ç‰‡æ–‡ä»¶ (JPG, PNG, WebP)', `æª”æ¡ˆé¡å‹: ${file.type}`);
                    return;
                }
                
                try {
                    // Compress image if it's too large
                    let processedFile = file;
                    if (file.size > 1024 * 1024) { // If larger than 1MB
                        addDebugLog('æª”æ¡ˆéå¤§ï¼Œé–‹å§‹å£“ç¸®');
                        processedFile = await compressImage(file);
                    }
                    
                    selectedFile = processedFile;
                    
                    addDebugLog('é–‹å§‹è®€å–æª”æ¡ˆé è¦½');
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        addDebugLog('æª”æ¡ˆé è¦½è¼‰å…¥å®Œæˆ', {
                            resultLength: e.target.result.length,
                            resultType: typeof e.target.result
                        });
                        previewImg.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        analyzeBtn.classList.remove('hidden');
                        hideError();
                    };
                    reader.onerror = function(error) {
                        addDebugLog('æª”æ¡ˆè®€å–éŒ¯èª¤', error);
                        showError('ç„¡æ³•è®€å–é¸æ“‡çš„åœ–ç‰‡æ–‡ä»¶', `éŒ¯èª¤: ${error}`);
                    };
                    reader.readAsDataURL(processedFile);
                    
                } catch (error) {
                    addDebugLog('æª”æ¡ˆè™•ç†éŒ¯èª¤', error);
                    showError('è™•ç†åœ–ç‰‡æ™‚ç™¼ç”ŸéŒ¯èª¤', error.message);
                }
            } else {
                addDebugLog('æœªé¸æ“‡æª”æ¡ˆ');
                selectedFile = null;
                imagePreview.classList.add('hidden');
                analyzeBtn.classList.add('hidden');
            }
        });

        // Check if we're running on Poe platform or standalone
        function checkPlatform() {
            if (typeof window.Poe !== 'undefined') {
                return 'poe';
            } else {
                return 'standalone';
            }
        }

        // Initialize platform-specific handlers
        function initializePlatform() {
            const platform = checkPlatform();
            
            if (platform === 'poe') {
                initializePoeHandlers();
            } else {
                initializeStandaloneMode();
            }
            
            return platform;
        }

        function initializeStandaloneMode() {
            console.log('Running in standalone mode');
            
            // Show standalone mode notice
            const standaloneNotice = document.createElement('div');
            standaloneNotice.className = 'bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6';
            standaloneNotice.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-blue-600 text-2xl">ğŸŒ</div>
                    <div>
                        <h3 class="text-blue-800 dark:text-blue-200 font-semibold text-lg">ç¨ç«‹æ¨¡å¼é‹è¡Œ</h3>
                        <p class="text-blue-700 dark:text-blue-300 text-sm mt-1">
                            æ­¤æ‡‰ç”¨ç¨‹å¼æ­£åœ¨ç¨ç«‹æ¨¡å¼ä¸‹é‹è¡Œã€‚AIåˆ†æåŠŸèƒ½å°‡ä½¿ç”¨æ¨¡æ“¬æ•¸æ“šé€²è¡Œæ¼”ç¤ºã€‚
                            <br>å®Œæ•´åŠŸèƒ½è«‹è¨ªå• <a href="https://poe.com" target="_blank" class="underline">Poeå¹³å°ç‰ˆæœ¬</a>ã€‚
                        </p>
                    </div>
                </div>
            `;
            
            const header = document.querySelector('header');
            header.insertAdjacentElement('afterend', standaloneNotice);
        }

        function initializePoeHandlers() {
            // Register AI response handlers for Poe platform
            window.Poe.registerHandler("nutrition-analysis", handleNutritionAnalysis);
            window.Poe.registerHandler("product-recommendations", handleProductRecommendations);
        }

        // Initialize platform and handlers
        const platform = initializePlatform();

        // Standalone mode simulation functions
        function simulateNutritionAnalysis(personalInfo) {
            const mockAnalysis = `
## ç‡Ÿé¤Šæˆåˆ†åˆ†æ
**æ¨¡æ“¬æ•¸æ“š - ä»¥ç¶­ä»–å‘½Dç‚ºä¾‹**
- ç¶­ä»–å‘½D3 (è†½éˆ£åŒ–é†‡): 1000 IU
- éˆ£: 200mg  
- é‚: 100mg
- ç¶­ä»–å‘½K2: 45mcg

## ç‡Ÿé¤Šç´ åŠŸæ•ˆ
**ç¶­ä»–å‘½D3çš„åŠŸæ•ˆï¼š**
- ä¿ƒé€²éˆ£è³ªå¸æ”¶ï¼Œç¶­è­·éª¨éª¼å¥åº·
- æ”¯æŒå…ç–«ç³»çµ±æ­£å¸¸åŠŸèƒ½
- æœ‰åŠ©æ–¼è‚Œè‚‰åŠŸèƒ½ç¶­æŒ
- åƒèˆ‡ç´°èƒåˆ†è£‚éç¨‹

**éˆ£çš„åŠŸæ•ˆï¼š**
- ç¶­æŒéª¨éª¼å’Œç‰™é½’å¥åº·
- æ”¯æŒè‚Œè‚‰æ”¶ç¸®åŠŸèƒ½
- åƒèˆ‡ç¥ç¶“å‚³å°

## å»ºè­°æ”å–é‡
- **ç¶­ä»–å‘½D3**: æ¯æ—¥1000-2000 IU
- **éˆ£**: æ¯æ—¥800-1200mg
- **å»ºè­°æœç”¨æ™‚é–“**: é¤å¾Œæœç”¨ï¼Œæå‡å¸æ”¶ç‡

${personalInfo.bmi ? `## å€‹äººåŒ–é©ç”¨æ€§è©•ä¼°\næ ¹æ“šæ‚¨çš„BMI ${personalInfo.bmi}ï¼Œæ­¤ç”¢å“é©åˆæ‚¨ä½¿ç”¨ã€‚\nå»ºè­°é…åˆé©åº¦é‹å‹•ä»¥æå‡ç¶­ä»–å‘½Dåˆæˆæ•ˆç‡ã€‚` : ''}

## æ³¨æ„äº‹é …
- é¿å…èˆ‡æŸäº›è—¥ç‰©åŒæ™‚æœç”¨
- è…åŠŸèƒ½ä¸å…¨è€…è«‹è«®è©¢é†«ç”Ÿ
- éé‡æ”å–å¯èƒ½å°è‡´é«˜è¡€éˆ£

âš ï¸ **é‡è¦æé†’**: æ­¤ç‚ºæ¨¡æ“¬æ•¸æ“šï¼Œå¯¦éš›ä½¿ç”¨è«‹è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡ã€‚
            `;
            
            return mockAnalysis;
        }

        function simulateProductRecommendations(personalInfo) {
            const healthGoals = personalInfo.healthGoals || [];
            const budget = personalInfo.budget || 'HK$ 1,000';
            
            const mockRecommendations = `
## ğŸ¯ æ™ºèƒ½ç‡Ÿé¤Šç”¢å“æ¨è–¦ç³»çµ±

### é‡å°æ‚¨çš„å¥åº·ç›®æ¨™æ¨è–¦ï¼š

${healthGoals.includes('æå‡å…ç–«åŠ›') ? `
**ğŸ›¡ï¸ å…ç–«åŠ›æå‡æ–¹æ¡ˆï¼š**
- **ç¶­ä»–å‘½C 1000mg** - NOW Foods
  - åƒ¹æ ¼ï¼šHK$120/ç“¶ (60ç²’)
  - èªè­‰ï¼šGMPèªè­‰
  - è³¼è²·é€£çµï¼š[iHerbå„ªæƒ ](https://iherb.com) - 15% OFF

- **ç¶­ä»–å‘½D3 2000 IU** - Nature Made  
  - åƒ¹æ ¼ï¼šHK$180/ç“¶ (100ç²’)
  - èªè­‰ï¼šUSPèªè­‰
  - é æœŸæ•ˆæœï¼š4-6é€±å…§æ”¹å–„å…ç–«åŠŸèƒ½
` : ''}

${healthGoals.includes('æ¸›è‚¥ç˜¦èº«') ? `
**ğŸƒâ€â™€ï¸ æ¸›è‚¥ç˜¦èº«æ–¹æ¡ˆï¼š**
- **ç¶ èŒ¶èƒå–ç‰©** - Life Extension
  - åƒ¹æ ¼ï¼šHK$280/ç“¶ (60ç²’)  
  - èªè­‰ï¼šç¬¬ä¸‰æ–¹æª¢æ¸¬
  - åŠŸæ•ˆï¼šæå‡æ–°é™³ä»£è¬ï¼Œè¼”åŠ©è„‚è‚ªç‡ƒç‡’

- **å·¦æ—‹è‚‰é¹¼** - NOW Foods
  - åƒ¹æ ¼ï¼šHK$240/ç“¶ (90ç²’)
  - èªè­‰ï¼šGMPèªè­‰
  - é…åˆé‹å‹•æ•ˆæœæ›´ä½³
` : ''}

### ğŸ’° æ ¹æ“šæ‚¨çš„é ç®— ${budget}

**æ¨è–¦çµ„åˆæ–¹æ¡ˆï¼š**
- åŸºç¤å¥åº·å¥—é¤ï¼šç´„ HK$580/æœˆ
- é€²éšç‡Ÿé¤Šçµ„åˆï¼šç´„ HK$850/æœˆ  
- é ‚ç´šå°ˆæ¥­é…ç½®ï¼šç´„ HK$1,200/æœˆ

${personalInfo.smartFeatures?.includes('ä¸€éµè³¼ç‰©æ•´åˆ') ? `
### ğŸ›’ ä¸€éµè³¼ç‰©æ•´åˆ
**ç›´æ¥è³¼è²·é€£çµï¼š**
- [iHerbå®˜ç¶²](https://iherb.com) - æ–°ç”¨æˆ¶15% OFF
- [Vitacost](https://vitacost.com) - æ»¿é¡å…é‹  
- å±ˆè‡£æ°é–€å¸‚ - å³æ™‚å–è²¨

**æœ¬æœˆç‰¹æƒ ï¼š**
- Thorneå“ç‰Œï¼šå°ˆå±¬8æŠ˜å„ªæƒ ç¢¼ "HEALTH20"
- NOW Foodsï¼šè²·äºŒé€ä¸€ç‰¹åƒ¹ä¸­
` : ''}

${personalInfo.smartFeatures?.includes('å¥åº·æˆæ•ˆè¿½è¹¤') ? `
### ğŸ“ˆ å¥åº·æˆæ•ˆè¿½è¹¤è¨ˆåŠƒ
**è¿½è¹¤æ™‚ç¨‹è¡¨ï¼š**
- ç¬¬1é€±ï¼šè¨˜éŒ„åŸºç¤æ•¸æ“šï¼ˆé«”é‡ã€ç²¾ç¥ç‹€æ…‹ï¼‰
- ç¬¬4é€±ï¼šåˆæ­¥æ•ˆæœè©•ä¼°  
- ç¬¬8é€±ï¼šä¸­æœŸæˆæœæª¢è¦–
- ç¬¬12é€±ï¼šæ•´é«”æ•ˆæœè©•ä¼°

**å»ºè­°ç›£æ¸¬æŒ‡æ¨™ï¼š**
- æ¯æ—¥ç²¾ç¥ç‹€æ…‹è©•åˆ†
- æ¯é€±é«”é‡è®ŠåŒ–
- ç¡çœ å“è³ªæ”¹å–„ç¨‹åº¦
` : ''}

${personalInfo.smartFeatures?.includes('é«˜ç´šæœƒå“¡è¨‚é–±') ? `
### ğŸ‘‘ é«˜ç´šæœƒå“¡è¨‚é–±æœå‹™
**æœƒå“¡æ–¹æ¡ˆï¼š**
- æ¨™æº–æœƒå“¡ï¼šHK$98/æœˆ - åŸºç¤è«®è©¢æœå‹™
- é«˜ç´šæœƒå“¡ï¼šHK$198/æœˆ - å°ˆæ¥­ç‡Ÿé¤Šå¸«è«®è©¢
- ç™½é‡‘æœƒå“¡ï¼šHK$398/æœˆ - ä¸€å°ä¸€å®šåˆ¶æ–¹æ¡ˆ

**æœƒå“¡å°ˆå±¬ç¦åˆ©ï¼š**
- æ¯æœˆ30åˆ†é˜ç‡Ÿé¤Šå¸«ç·šä¸Šè«®è©¢
- æ–°å“å…è²»è©¦ç”¨è³‡æ ¼  
- 24/7å°ˆå±¬å®¢æœæ”¯æ´
- å®šæœŸå¥åº·å ±å‘Š
` : ''}

### âš ï¸ æ³¨æ„äº‹é …
- æ­¤ç‚ºæ¼”ç¤ºæ¨¡æ“¬æ•¸æ“šï¼Œå¯¦éš›ç”¢å“å»ºè­°è«‹è«®è©¢å°ˆæ¥­äººå“¡
- è³¼è²·å‰è«‹ç¢ºèªç”¢å“èªè­‰æ¨™èªŒ
- å¦‚æœ‰æ…¢æ€§ç–¾ç—…ï¼Œè«‹å…ˆè«®è©¢é†«ç”Ÿ

**ğŸŒŸ å‡ç´šåˆ°å®Œæ•´ç‰ˆï¼š** [è¨ªå•Poeå¹³å°](https://poe.com)ç²å¾—çœŸå¯¦AIåˆ†æåŠŸèƒ½ï¼
            `;
            
            return mockRecommendations;
        }

        // Platform-specific initialization
        if (platform === 'poe') {
            // Handler for nutrition label analysis
            window.Poe.registerHandler("nutrition-analysis", (result, context) => {
                console.log('Handler called with result:', JSON.stringify(result));
                
                try {
                    if (!result || !result.responses || result.responses.length === 0) {
                        showError("æ²’æœ‰æ”¶åˆ°åˆ†æçµæœ");
                        resetAnalyzeButton();
                        return;
                    }
                    
                    const msg = result.responses[0];
                    console.log('Message status:', msg.status, 'Content length:', msg.content?.length);
                    
                    if (msg.status === "error") {
                        showError("åˆ†æéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼š" + (msg.statusText || "æœªçŸ¥éŒ¯èª¤"));
                        resetAnalyzeButton();
                        return;
                    }
                    
                    if (msg.status === "incomplete") {
                        // Keep showing loading state
                        return;
                    }
                    
                    if (msg.status === "complete") {
                        console.log('Analysis complete, displaying results');
                        hideLoading();
                        if (msg.content && msg.content.trim()) {
                            parseAndDisplayResults(msg.content);
                        } else {
                            showError("æ”¶åˆ°ç©ºçš„åˆ†æçµæœ");
                        }
                        resetAnalyzeButton();
                    }
                } catch (error) {
                    console.error('Handler error:', error);
                    showError("è™•ç†åˆ†æçµæœæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š" + error.message);
                    resetAnalyzeButton();
                }
            });

            // Handler for product recommendations
            window.Poe.registerHandler("product-recommendations", (result, context) => {
                addDebugLog('æ¨è–¦è™•ç†å™¨è¢«èª¿ç”¨', result);
                
                try {
                    if (!result || !result.responses || result.responses.length === 0) {
                        showError("æ²’æœ‰æ”¶åˆ°æ¨è–¦çµæœ");
                        resetRecommendButton();
                        return;
                    }
                    
                    const msg = result.responses[0];
                    addDebugLog('æ¨è–¦è¨Šæ¯ç‹€æ…‹', { status: msg.status, contentLength: msg.content?.length });
                    
                    if (msg.status === "error") {
                        showError("ç²å–æ¨è–¦æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š" + (msg.statusText || "æœªçŸ¥éŒ¯èª¤"));
                        resetRecommendButton();
                        return;
                    }
                    
                    if (msg.status === "incomplete") {
                        // Keep showing loading state
                        return;
                    }
                    
                    if (msg.status === "complete") {
                        addDebugLog('æ¨è–¦å®Œæˆï¼Œé¡¯ç¤ºçµæœ');
                        hideLoading();
                        if (msg.content && msg.content.trim()) {
                            parseAndDisplayRecommendations(msg.content);
                        } else {
                            showError("æ”¶åˆ°ç©ºçš„æ¨è–¦çµæœ");
                        }
                        resetRecommendButton();
                    }
                } catch (error) {
                    console.error('Recommendation handler error:', error);
                    showError("è™•ç†æ¨è–¦çµæœæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š" + error.message);
                    resetRecommendButton();
                }
            });
        }

        function resetAnalyzeButton() {
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'ğŸ” åˆ†æç‡Ÿé¤Šæ¨™ç±¤';
        }

        // Function to collect personal information
        function collectPersonalInfo() {
            const personalInfo = {
                gender: document.getElementById('gender').value,
                age: document.getElementById('age').value,
                height: document.getElementById('height').value,
                weight: document.getElementById('weight').value,
                activityLevel: document.getElementById('activityLevel').value,
                medicalConditions: document.getElementById('medicalConditions').value.trim(),
                currentMedications: document.getElementById('currentMedications').value.trim(),
                customHealthGoals: document.getElementById('customHealthGoals').value.trim()
            };

            // Collect specific improvement targets
            const targets = [];
            const target1 = document.getElementById('target1').value.trim();
            const target2 = document.getElementById('target2').value.trim();
            const target3 = document.getElementById('target3').value.trim();
            
            if (target1) targets.push(target1);
            if (target2) targets.push(target2);
            if (target3) targets.push(target3);
            
            personalInfo.improvementTargets = targets;
            
            // Collect checked health goals
            const healthGoals = [];
            const goalCheckboxes = [
                { id: 'skinIssues', label: 'çš®è†šå•é¡Œ' },
                { id: 'weightLoss', label: 'æ¸›è‚¥ç˜¦èº«' },
                { id: 'jointPain', label: 'é—œç¯€ç–¼ç—›' },
                { id: 'sciatica', label: 'åéª¨ç¥ç¶“ç—›' },
                { id: 'immunity', label: 'æå‡å…ç–«åŠ›' },
                { id: 'energy', label: 'å¢åŠ é«”åŠ›' },
                { id: 'sleep', label: 'æ”¹å–„ç¡çœ ' },
                { id: 'digestion', label: 'æ¶ˆåŒ–å•é¡Œ' },
                { id: 'memory', label: 'å¢å¼·è¨˜æ†¶' },
                { id: 'stress', label: 'èˆ’ç·©å£“åŠ›' },
                { id: 'heartHealth', label: 'å¿ƒè¡€ç®¡å¥åº·' },
                { id: 'eyeHealth', label: 'è­·çœ¼æ˜ç›®' },
                { id: 'boneHealth', label: 'éª¨éª¼å¥åº·' },
                { id: 'hairHealth', label: 'é ­é«®å¥åº·' },
                { id: 'bloodSugar', label: 'è¡€ç³–æ§åˆ¶' },
                { id: 'cholesterol', label: 'è†½å›ºé†‡ç®¡ç†' }
            ];
            
            goalCheckboxes.forEach(goal => {
                if (document.getElementById(goal.id).checked) {
                    healthGoals.push(goal.label);
                }
            });
            
            personalInfo.healthGoals = healthGoals;
            
            // Collect AI smart features preferences
            const smartFeatures = [];
            const featureCheckboxes = [
                { id: 'aiPersonalized', label: 'AIå€‹äººåŒ–åˆ†æ' },
                { id: 'smartRecommendation', label: 'æ™ºèƒ½ç”¢å“æ¨è–¦å¼•æ“' },
                { id: 'oneClickShopping', label: 'ä¸€éµè³¼ç‰©æ•´åˆ' },
                { id: 'progressTracking', label: 'å¥åº·æˆæ•ˆè¿½è¹¤' },
                { id: 'brandPartnership', label: 'å“ç‰Œåˆä½œå„ªæƒ ' },
                { id: 'premiumMembership', label: 'é«˜ç´šæœƒå“¡è¨‚é–±' }
            ];
            
            featureCheckboxes.forEach(feature => {
                if (document.getElementById(feature.id).checked) {
                    smartFeatures.push(feature.label);
                }
            });
            
            personalInfo.smartFeatures = smartFeatures;

            // Collect budget information
            const customBudget = document.getElementById('customBudget').value.trim();
            const selectedBudgetRadio = document.querySelector('input[name="budget"]:checked');
            
            if (customBudget) {
                personalInfo.budget = `HK$ ${customBudget}`;
                personalInfo.budgetAmount = parseInt(customBudget);
            } else if (selectedBudgetRadio) {
                const budgetMap = {
                    'under650': { label: 'HK$ 650 ä»¥ä¸‹', amount: 650 },
                    '650-1000': { label: 'HK$ 650-1,000', amount: 825 },
                    '1000-1500': { label: 'HK$ 1,000-1,500', amount: 1250 },
                    'over1500': { label: 'HK$ 1,500 ä»¥ä¸Š', amount: 1800 }
                };
                const budgetInfo = budgetMap[selectedBudgetRadio.value];
                personalInfo.budget = budgetInfo.label;
                personalInfo.budgetAmount = budgetInfo.amount;
            }
            
            // Calculate BMI if height and weight are provided
            if (personalInfo.height && personalInfo.weight) {
                const heightM = personalInfo.height / 100;
                personalInfo.bmi = (personalInfo.weight / (heightM * heightM)).toFixed(1);
            }
            
            return personalInfo;
        }

        // Function to format personal info for AI prompt
        function formatPersonalInfoForPrompt(info) {
            const hasBasicInfo = info.gender || info.age || info.height || info.weight || info.medicalConditions || info.currentMedications;
            const hasHealthGoals = (info.healthGoals && info.healthGoals.length > 0) || info.customHealthGoals;
            
            if (!hasBasicInfo && !hasHealthGoals) {
                return '';
            }
            
            let personalText = '\n\n## å€‹äººè³‡æ–™\n';
            
            if (info.gender) {
                personalText += `- æ€§åˆ¥: ${info.gender === 'male' ? 'ç”·æ€§' : 'å¥³æ€§'}\n`;
            }
            if (info.age) {
                personalText += `- å¹´é½¡: ${info.age}æ­²\n`;
            }
            if (info.height) {
                personalText += `- èº«é«˜: ${info.height}cm\n`;
            }
            if (info.weight) {
                personalText += `- é«”é‡: ${info.weight}kg\n`;
            }
            if (info.bmi) {
                personalText += `- BMI: ${info.bmi}\n`;
            }
            if (info.activityLevel) {
                const activityMap = {
                    'sedentary': 'ä¹…å (å¾ˆå°‘é‹å‹•)',
                    'light': 'è¼•åº¦ (æ¯é€±1-3æ¬¡é‹å‹•)',
                    'moderate': 'ä¸­åº¦ (æ¯é€±3-5æ¬¡é‹å‹•)',
                    'active': 'é«˜åº¦ (æ¯é€±6-7æ¬¡é‹å‹•)',
                    'very_active': 'æ¥µé«˜ (æ¯å¤©é‹å‹•æˆ–é«”åŠ›å·¥ä½œ)'
                };
                personalText += `- æ´»å‹•é‡: ${activityMap[info.activityLevel]}\n`;
            }
            if (info.medicalConditions) {
                personalText += `- å¥åº·ç‹€æ³: ${info.medicalConditions}\n`;
            }
            if (info.currentMedications) {
                personalText += `- ç›®å‰ç”¨è—¥/è£œå……å“: ${info.currentMedications}\n`;
            }
            
            // Add health goals
            if (hasHealthGoals) {
                personalText += `- æƒ³è¦æ”¹å–„çš„å¥åº·å•é¡Œ: `;
                const allGoals = [];
                if (info.healthGoals && info.healthGoals.length > 0) {
                    allGoals.push(...info.healthGoals);
                }
                if (info.customHealthGoals) {
                    allGoals.push(info.customHealthGoals);
                }
                personalText += allGoals.join('ã€') + '\n';
            }
            
            // Add specific improvement targets
            if (info.improvementTargets && info.improvementTargets.length > 0) {
                personalText += `- å…·é«”æ”¹å–„ç›®æ¨™: ${info.improvementTargets.join('ã€')}\n`;
            }
            
            // Add budget information
            if (info.budget) {
                personalText += `- æ¯æœˆé ç®—: ${info.budget}\n`;
            }
            
            // Add smart features preferences
            if (info.smartFeatures && info.smartFeatures.length > 0) {
                personalText += `- å•Ÿç”¨æ™ºèƒ½åŠŸèƒ½: ${info.smartFeatures.join('ã€')}\n`;
            }
            
            return personalText;
        }

        // Analyze button click
        analyzeBtn.addEventListener('click', async function() {
            console.log('Analyze button clicked');
            
            if (platform === 'standalone') {
                // Standalone mode - use simulated analysis
                const personalInfo = collectPersonalInfo();
                
                // Disable button during analysis
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'åˆ†æä¸­...';
                
                showLoading();
                hideError();
                hideResults();
                
                // Simulate processing time
                setTimeout(() => {
                    const simulatedResult = simulateNutritionAnalysis(personalInfo);
                    hideLoading();
                    parseAndDisplayResults(simulatedResult);
                    resetAnalyzeButton();
                }, 2000);
                
                return;
            }
            
            if (!selectedFile) {
                showError('è«‹å…ˆé¸æ“‡åœ–ç‰‡æ–‡ä»¶');
                return;
            }
            
            // Additional file validation
            if (selectedFile.size > 10 * 1024 * 1024) { // 10MB limit
                showError('åœ–ç‰‡æ–‡ä»¶éå¤§ï¼Œè«‹é¸æ“‡å°æ–¼ 10MB çš„åœ–ç‰‡');
                return;
            }
            
            console.log('Starting analysis with file:', selectedFile.name, 'Size:', selectedFile.size, 'Type:', selectedFile.type);
            
            // Collect personal information
            const personalInfo = collectPersonalInfo();
            const personalInfoText = formatPersonalInfoForPrompt(personalInfo);
            
            // Disable button during analysis
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'åˆ†æä¸­...';
            
            showLoading();
            hideError();
            hideResults();
            
            try {
                const prompt = `@Claude-Sonnet-4 è«‹åˆ†æé€™å€‹ç‡Ÿé¤Šè£œå……å“æ¨™ç±¤åœ–ç‰‡ï¼Œä¸¦æä¾›ä»¥ä¸‹è³‡è¨Šï¼ˆè«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼‰ï¼š${personalInfoText}

## ç‡Ÿé¤Šæˆåˆ†åˆ†æ
è«‹è­˜åˆ¥ä¸¦åˆ—å‡ºæ¨™ç±¤ä¸Šçš„æ‰€æœ‰ç‡Ÿé¤Šæˆåˆ†åŠå…¶å«é‡

## ç‡Ÿé¤Šç´ åŠŸæ•ˆ
è©³ç´°èªªæ˜æ¯ç¨®ç‡Ÿé¤Šç´ å°äººé«”çš„åŠŸæ•ˆå’Œä½œç”¨

## å»ºè­°æ”å–é‡
æ ¹æ“šæ¨™ç±¤è³‡è¨Šå’Œä¸€èˆ¬å»ºè­°ï¼Œèªªæ˜æ¯æ—¥å»ºè­°æ”å–é‡å’Œä½¿ç”¨æ–¹å¼

${personalInfoText ? '## å€‹äººåŒ–é©ç”¨æ€§è©•ä¼°\næ ¹æ“šæä¾›çš„å€‹äººè³‡æ–™ï¼Œè©•ä¼°æ­¤ç‡Ÿé¤Šè£œå……å“æ˜¯å¦é©åˆä½¿ç”¨è€…ï¼š\n- æ˜¯å¦é©åˆæ­¤å¹´é½¡å’Œæ€§åˆ¥\n- æ ¹æ“šBMIå’Œæ´»å‹•é‡çš„å»ºè­°\n- èˆ‡ç¾æœ‰å¥åº·ç‹€æ³æˆ–ç”¨è—¥çš„äº’å‹•é¢¨éšª\n- å€‹äººåŒ–çš„åŠ‘é‡å»ºè­°\n- ç‰¹åˆ¥æ³¨æ„äº‹é …\n\n' : ''}## æ³¨æ„äº‹é …
æåŠå¯èƒ½çš„å‰¯ä½œç”¨ã€ç¦å¿Œç—‡æˆ–æ³¨æ„äº‹é …

è«‹ç¢ºä¿è³‡è¨Šæº–ç¢ºä¸”å¯¦ç”¨ã€‚å¦‚æœç„¡æ³•æ¸…æ¥šè­˜åˆ¥æ¨™ç±¤å…§å®¹ï¼Œè«‹èªªæ˜å“ªäº›éƒ¨åˆ†ç„¡æ³•è¾¨è­˜ã€‚${personalInfoText ? '\n\nâš ï¸ é‡è¦ï¼šæ­¤åˆ†æåƒ…ä¾›åƒè€ƒï¼Œå¦‚æœ‰å¥åº·å•é¡Œè«‹è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡ã€‚' : ''}`;

                console.log('Sending message to Poe API with file:', selectedFile.name);
                
                const result = await window.Poe.sendUserMessage(prompt, {
                    attachments: [selectedFile],
                    handler: "nutrition-analysis",
                    stream: false,
                    openChat: false
                });
                
                console.log('Message sent successfully:', JSON.stringify(result));
                
                // Set a timeout in case handler doesn't get called
                setTimeout(() => {
                    if (analyzeBtn.disabled) {
                        showError('åˆ†æè¶…æ™‚ï¼Œè«‹é‡è©¦');
                        resetAnalyzeButton();
                    }
                }, 60000); // 60 second timeout
                
            } catch (err) {
                console.error('Error during analysis:', err);
                let errorMsg = "ç™¼é€åˆ†æè«‹æ±‚æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š";
                
                if (err.errorType) {
                    switch(err.errorType) {
                        case "USER_REJECTED_CONFIRMATION":
                            errorMsg += "ç”¨æˆ¶å–æ¶ˆäº†ç¢ºèªå°è©±æ¡†";
                            break;
                        case "INVALID_INPUT":
                            errorMsg += "è¼¸å…¥ç„¡æ•ˆï¼Œè«‹æª¢æŸ¥åœ–ç‰‡æ ¼å¼";
                            break;
                        case "ANOTHER_CONFIRMATION_IS_OPEN":
                            errorMsg += "å¦ä¸€å€‹ç¢ºèªå°è©±æ¡†å·²é–‹å•Ÿ";
                            break;
                        default:
                            errorMsg += err.message || "æœªçŸ¥éŒ¯èª¤";
                    }
                } else {
                    errorMsg += err.message || "æœªçŸ¥éŒ¯èª¤";
                }
                
                showError(errorMsg);
                resetAnalyzeButton();
            }
        });

        // Recommend button click
        document.getElementById('recommendBtn').addEventListener('click', async function() {
            addDebugLog('æ¨è–¦æŒ‰éˆ•è¢«é»æ“Š');
            
            // Collect personal information
            const personalInfo = collectPersonalInfo();
            const hasHealthGoals = (personalInfo.healthGoals && personalInfo.healthGoals.length > 0) || personalInfo.customHealthGoals;
            
            if (!hasHealthGoals) {
                showError('è«‹å…ˆé¸æ“‡æƒ³è¦æ”¹å–„çš„å¥åº·å•é¡Œï¼Œä»¥ç²å¾—å€‹äººåŒ–æ¨è–¦');
                return;
            }
            
            if (platform === 'standalone') {
                // Standalone mode - use simulated recommendations
                
                // Disable button during recommendation
                this.disabled = true;
                this.textContent = 'ç²å–æ¨è–¦ä¸­...';
                
                showLoading();
                hideError();
                hideResults();
                
                // Simulate processing time
                setTimeout(() => {
                    const simulatedResult = simulateProductRecommendations(personalInfo);
                    hideLoading();
                    parseAndDisplayRecommendations(simulatedResult);
                    resetRecommendButton();
                }, 3000);
                
                return;
            }
            
            // Disable button during recommendation
            this.disabled = true;
            this.textContent = 'ç²å–æ¨è–¦ä¸­...';
            
            showLoading();
            hideError();
            hideResults();
            
            try {
                const personalInfoText = formatPersonalInfoForPrompt(personalInfo);
                
                // Create smart features enhanced prompt
                let smartPrompt = '';
                if (personalInfo.smartFeatures && personalInfo.smartFeatures.length > 0) {
                    const features = personalInfo.smartFeatures;
                    
                    if (features.includes('AIå€‹äººåŒ–åˆ†æ')) {
                        smartPrompt += `\n### ğŸ¤– AIå€‹äººåŒ–æ·±åº¦åˆ†æ\nåŸºæ–¼ç”¨æˆ¶çš„å¥åº·æ•¸æ“šã€ç”Ÿæ´»å‹æ…‹å’Œç›®æ¨™ï¼Œæä¾›æ·±åº¦å€‹äººåŒ–åˆ†æï¼š\n- å¥åº·é¢¨éšªè©•ä¼°å’Œé é˜²å»ºè­°\n- ç‡Ÿé¤Šç´ ç¼ºä¹å¯èƒ½æ€§åˆ†æ\n- åŸºæ–¼éºå‚³å‚¾å‘çš„å»ºè­°ï¼ˆå¦‚é©ç”¨ï¼‰\n- ç”Ÿæ´»æ–¹å¼å„ªåŒ–å»ºè­°\n`;
                    }
                    
                    if (features.includes('æ™ºèƒ½ç”¢å“æ¨è–¦å¼•æ“')) {
                        smartPrompt += `\n### ğŸ§  æ™ºèƒ½ç”¢å“æ¨è–¦å¼•æ“\nä½¿ç”¨AIæ¼”ç®—æ³•æä¾›æœ€ç²¾ç¢ºçš„ç”¢å“é…å°ï¼š\n- æˆåˆ†å”åŒæ•ˆæ‡‰åˆ†æ\n- æœ€ä½³æ™‚é–“æœç”¨å»ºè­°\n- ç”¢å“äº’å‹•æ€§æª¢æŸ¥\n- å€‹äººåŒ–åŠ‘é‡å„ªåŒ–\n`;
                    }
                    
                    if (features.includes('ä¸€éµè³¼ç‰©æ•´åˆ')) {
                        smartPrompt += `\n### ğŸ›’ ä¸€éµè³¼ç‰©æ•´åˆ\næä¾›ä¾¿æ·çš„è³¼ç‰©é«”é©—ï¼š\n- æ¨è–¦ç”¢å“çš„ç›´æ¥è³¼è²·é€£çµ\n- æ¯”åƒ¹å’Œå„ªæƒ è³‡è¨Š\n- åº«å­˜ç‹€æ…‹å’Œé…é€æ™‚é–“\n- è‡ªå‹•è£œè²¨æé†’è¨­å®š\n**è³¼è²·é€£çµç¯„ä¾‹ï¼š**\n- iHerb: [ç”¢å“åç¨±](https://iherb.com/product-link) - 15% OFF\n- Vitacost: [ç”¢å“åç¨±](https://vitacost.com/product-link) - 20% OFF\n- æœ¬åœ°è—¥æˆ¿: [ç”¢å“åç¨±] - é–€å¸‚å–è²¨\n`;
                    }
                    
                    if (features.includes('å¥åº·æˆæ•ˆè¿½è¹¤')) {
                        smartPrompt += `\n### ğŸ“ˆ å¥åº·æˆæ•ˆè¿½è¹¤è¨ˆåŠƒ\nåˆ¶å®šå¯é‡åŒ–çš„è¿½è¹¤æ–¹æ¡ˆï¼š\n- æ¯é€±/æ¯æœˆçš„å¥åº·æŒ‡æ¨™ç›£æ¸¬\n- é æœŸæ”¹å–„æ™‚é–“è¡¨\n- æˆæ•ˆè©•ä¼°æ¨™æº–\n- èª¿æ•´å»ºè­°æ™‚æ©Ÿ\n**è¿½è¹¤æŒ‡æ¨™ç¯„ä¾‹ï¼š**\n- ç¬¬1é€±ï¼šåŸºç¤æ•¸æ“šè¨˜éŒ„\n- ç¬¬4é€±ï¼šåˆæ­¥æ•ˆæœè©•ä¼°\n- ç¬¬8é€±ï¼šä¸­æœŸæˆæœæª¢è¦–\n- ç¬¬12é€±ï¼šæ•´é«”æ•ˆæœè©•ä¼°\n`;
                    }
                    
                    if (features.includes('å“ç‰Œåˆä½œå„ªæƒ ')) {
                        smartPrompt += `\n### ğŸ¤ å“ç‰Œåˆä½œå°ˆå±¬å„ªæƒ \næä¾›ç¨å®¶æŠ˜æ‰£å’Œåˆä½œæ–¹æ¡ˆï¼š\n- æœƒå“¡å°ˆå±¬æŠ˜æ‰£ç¢¼\n- æ–°å“æ¶å…ˆé«”é©—\n- å“ç‰Œç›´é€æœå‹™\n- VIPå®¢æˆ¶ç¦®é‡\n**æœ¬æœˆåˆä½œå„ªæƒ ï¼š**\n- Thorne: å°ˆå±¬8æŠ˜å„ªæƒ ç¢¼ "HEALTH20"\n- NOW Foods: è²·äºŒé€ä¸€ç‰¹æƒ \n- å¤§ç ”ç”Ÿé†«: æ–°æœƒå“¡é¦–è³¼7æŠ˜\n`;
                    }
                    
                    if (features.includes('é«˜ç´šæœƒå“¡è¨‚é–±')) {
                        smartPrompt += `\n### ğŸ‘‘ é«˜ç´šæœƒå“¡è¨‚é–±æœå‹™\nå‡ç´šè‡³é«˜ç´šæœƒå“¡äº«å—å°ˆæ¥­æœå‹™ï¼š\n- æ¯æœˆå°ˆæ¥­ç‡Ÿé¤Šå¸«ç·šä¸Šè«®è©¢ï¼ˆ30åˆ†é˜ï¼‰\n- å®šæœŸå¥åº·å ±å‘Šå’Œå»ºè­°èª¿æ•´\n- æ–°å“å…è²»è©¦ç”¨è³‡æ ¼\n- 24/7å°ˆå±¬å®¢æœæ”¯æ´\n**æœƒå“¡æ–¹æ¡ˆï¼š**\n- æ¨™æº–æœƒå“¡ï¼šHK$98/æœˆ\n- é«˜ç´šæœƒå“¡ï¼šHK$198/æœˆ\n- ç™½é‡‘æœƒå“¡ï¼šHK$398/æœˆ\n`;
                    }
                }
                
                const prompt = `@Claude-Sonnet-4 è«‹æ ¹æ“šä»¥ä¸‹å€‹äººè³‡æ–™ï¼Œæ¨è–¦é©åˆçš„ç‡Ÿé¤Šè£œå……å“ï¼ˆè«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼‰ï¼š${personalInfoText}

## ğŸ¯ æ™ºèƒ½ç‡Ÿé¤Šç”¢å“æ¨è–¦ç³»çµ±
æ ¹æ“šç”¨æˆ¶æƒ³è¦æ”¹å–„çš„å¥åº·å•é¡Œå’Œå•Ÿç”¨çš„æ™ºèƒ½åŠŸèƒ½ï¼Œæä¾›å…¨é¢çš„ç‡Ÿé¤Šè£œå……å“å»ºè­°ï¼š

### é‡å°æ€§æ¨è–¦
å°æ–¼æ¯å€‹å¥åº·å•é¡Œï¼Œåˆ†åˆ¥æ¨è–¦ï¼š
- æœ€é©åˆçš„ç‡Ÿé¤Šç´ æˆ–è£œå……å“é¡å‹
- å…·é«”çš„ç”¢å“å»ºè­°ï¼ˆå¦‚ç¶­ä»–å‘½ã€ç¤¦ç‰©è³ªã€è‰æœ¬è£œå……å“ç­‰ï¼‰
- æ¨è–¦çš„åŸå› å’Œç§‘å­¸ä¾æ“š
- é æœŸæ”¹å–„æ™‚é–“å’Œæ•ˆæœ

### å€‹äººåŒ–å»ºè­°
è€ƒæ…®ç”¨æˆ¶çš„å¹´é½¡ã€æ€§åˆ¥ã€BMIã€æ´»å‹•é‡ç­‰å› ç´ ï¼š
- ç²¾ç¢ºåŠ‘é‡å»ºè­°
- æœ€ä½³æœç”¨æ™‚é–“å»ºè­°
- èˆ‡ç¾æœ‰ç”¨è—¥çš„æ³¨æ„äº‹é …
- ç”Ÿæ´»æ–¹å¼é…åˆå»ºè­°

${smartPrompt}

### å“ç‰Œèªè­‰æ¨è–¦
å„ªå…ˆæ¨è–¦æœ‰èªè­‰çš„å¯é å“ç‰Œï¼š

**USPèªè­‰å“ç‰Œï¼š**
- Nature Made (ç¾åœ‹è—¥å…¸èªè­‰ï¼Œç¶­ä»–å‘½Bç¾¤ã€é­šæ²¹ã€ç¶­ä»–å‘½C)
- å“è³ªä¿è­‰ï¼šâ˜…â˜…â˜…â˜…â˜…

**NSFèªè­‰å“ç‰Œï¼š**
- Thorne (NSF Sport + GMPï¼Œè‚Œé†‡è¤‡åˆç‰©ã€è¼”é…¶Q10ã€ç¶­ä»–å‘½Bç¾¤)
- Garden of Life (NSFæœ‰æ©Ÿèªè­‰ï¼Œç¶­ä»–å‘½Bç¾¤ã€ç›Šç”ŸèŒ)
- å“è³ªä¿è­‰ï¼šâ˜…â˜…â˜…â˜…â˜…

**GMPèªè­‰å“ç‰Œï¼š**
- NOW Foods (GMP + ç¬¬ä¸‰æ–¹æª¢æ¸¬ï¼Œè‚Œé†‡ã€Î±-ç¡«è¾›é…¸ã€å·¦æ—‹è‚‰é¹¼)
- å“è³ªä¿è­‰ï¼šâ˜…â˜…â˜…â˜…â˜†

**ç¬¬ä¸‰æ–¹æª¢æ¸¬å“ç‰Œï¼š**
- Life Extension (ç¬¬ä¸‰æ–¹æª¢æ¸¬ï¼Œç¶ èŒ¶èƒå–ç‰©ã€Omega-3ã€é‹…)
- Nordic Naturals (ç¬¬ä¸‰æ–¹ç´”åº¦æª¢æ¸¬ï¼ŒOmega-3é­šæ²¹)
- å“è³ªä¿è­‰ï¼šâ˜…â˜…â˜…â˜…â˜†

**å°ç£æœ¬åœŸèªè­‰å“ç‰Œï¼š**
- å¤§ç ”ç”Ÿé†« (ISO 22000ã€HACCPï¼Œå¾·åœ‹è‚Œé†‡ã€è—»æ²¹DHA)
- èˆ¹äº•ç”Ÿé†« (å¥é£Ÿå­—è™Ÿèªè­‰)
- ç™½è˜­æ° (ISOèªè­‰ï¼Œç¶­ä»–å‘½Bç¾¤)

### å»ºè­°å“ç‰Œçµ„åˆæ–¹æ¡ˆ
æ ¹æ“šç”¨æˆ¶çš„å¥åº·ç›®æ¨™å’Œé ç®—ï¼Œæä¾›å®Œæ•´çš„å“ç‰Œæ­é…å»ºè­°ï¼š

#### ğŸ’° ç¶“æ¿Ÿå¯¦æƒ çµ„åˆ (æœˆè²»ç”¨ç´„ HK$650-900 / USD$80-115)
é‡å°é ç®—æœ‰é™ä½†æ³¨é‡å“è³ªçš„ç”¨æˆ¶ï¼š
- **åŸºç¤æ¬¾çµ„åˆ**ï¼šé¸ç”¨NOW Foodsã€Nature Madeç­‰CPå€¼é«˜çš„èªè­‰å“ç‰Œ
- **é©åˆæ—ç¾¤**ï¼šå­¸ç”Ÿã€å°è³‡æ—ã€åˆæ¬¡å˜—è©¦ç‡Ÿé¤Šè£œå……å“è€…
- **å“è³ªä¿è­‰**ï¼šâ˜…â˜…â˜…â˜…â˜†

#### ğŸ’ å„ªè³ªå¹³è¡¡çµ„åˆ (æœˆè²»ç”¨ç´„ HK$1,000-1,400 / USD$125-180)  
é‡å°è¿½æ±‚å“è³ªèˆ‡æ•ˆæœå¹³è¡¡çš„ç”¨æˆ¶ï¼š
- **é€²éšæ¬¾çµ„åˆ**ï¼šæ··æ­Thorneã€Life Extensionã€Nordic Naturalsç­‰å“ç‰Œ
- **é©åˆæ—ç¾¤**ï¼šä¸Šç­æ—ã€æ³¨é‡å¥åº·çš„æˆå¹´äºº
- **å“è³ªä¿è­‰**ï¼šâ˜…â˜…â˜…â˜…â˜…

#### ğŸ† é ‚ç´šå°ˆæ¥­çµ„åˆ (æœˆè²»ç”¨ç´„ HK$1,500-2,000 / USD$190-250)
é‡å°è¿½æ±‚æœ€é«˜å“è³ªå’Œå°ˆæ¥­é…æ–¹çš„ç”¨æˆ¶ï¼š
- **å°ˆæ¥­æ¬¾çµ„åˆ**ï¼šä¸»è¦é¸ç”¨Thorneã€Garden of Lifeç­‰é ‚ç´šèªè­‰å“ç‰Œ
- **é©åˆæ—ç¾¤**ï¼šé«˜æ”¶å…¥æ—ç¾¤ã€æ…¢æ€§ç—…æ‚£è€…ã€é‹å‹•å“¡
- **å“è³ªä¿è­‰**ï¼šâ˜…â˜…â˜…â˜…â˜…

#### ğŸ‡¹ğŸ‡¼ å°ç£æœ¬åœŸçµ„åˆ (æœˆè²»ç”¨ç´„ HK$750-1,150 / USD$95-145)
é‡å°åå¥½æœ¬åœŸå“ç‰Œå’Œæ–¹ä¾¿è³¼è²·çš„ç”¨æˆ¶ï¼š
- **åœ¨åœ°æ¬¾çµ„åˆ**ï¼šå¤§ç ”ç”Ÿé†«ã€èˆ¹äº•ç”Ÿé†«ã€ç™½è˜­æ°ç­‰æœ¬åœŸèªè­‰å“ç‰Œ
- **é©åˆæ—ç¾¤**ï¼šåå¥½æœ¬åœŸå“ç‰Œã€é‡è¦–å”®å¾Œæœå‹™è€…
- **å“è³ªä¿è­‰**ï¼šâ˜…â˜…â˜…â˜…â˜†

è«‹é‡å°ç”¨æˆ¶çš„å…·é«”å¥åº·ç›®æ¨™ï¼Œå¾ä»¥ä¸Šçµ„åˆä¸­é¸æ“‡æœ€é©åˆçš„æ–¹æ¡ˆï¼Œä¸¦åˆ—å‡ºå…·é«”çš„ç”¢å“æ¸…å–®å’Œæ¯æœˆé ä¼°è²»ç”¨ã€‚

### å„ªå…ˆé †åº
æ ¹æ“šå¥åº·å•é¡Œçš„é‡è¦æ€§å’Œæ”¹å–„æ•ˆæœï¼Œå»ºè­°å„ªå…ˆè³¼è²·çš„ç”¢å“ï¼Œä¸¦å„ªå…ˆé¸æ“‡æœ‰èªè­‰çš„å“ç‰Œ

### è³¼è²·æŒ‡å—
- å°‹æ‰¾ç“¶èº«ä¸Šçš„èªè­‰æ¨™èªŒï¼šUSP Verifiedã€NSFåœ“å½¢æ¨™èªŒã€GMP Certified
- æ¨è–¦è³¼è²·é€šè·¯ï¼šiHerbã€Vitacostã€æœ¬åœ°é€£é–è—¥æˆ¿
- é¿å…åƒ¹æ ¼ç•°å¸¸ä¾¿å®œæˆ–ç„¡èªè­‰çš„ä¸çŸ¥åå“ç‰Œ

### æ³¨æ„äº‹é …
- è³¼è²·æ™‚è¦æ³¨æ„çš„å“è³ªæ¨™æº–å’Œèªè­‰æ¨™èªŒ
- å¯èƒ½çš„å‰¯ä½œç”¨æˆ–ç¦å¿Œ
- å»ºè­°è«®è©¢é†«ç”Ÿçš„æƒ…æ³

âš ï¸ é‡è¦ï¼šæ­¤æ¨è–¦åƒ…ä¾›åƒè€ƒï¼Œè«‹åœ¨è³¼è²·å‰è«®è©¢å°ˆæ¥­é†«ç™‚äººå“¡æˆ–ç‡Ÿé¤Šå¸«ã€‚èªè­‰ç¢ºä¿å“è³ªå’Œç´”åº¦ï¼Œä½†ä¸ç­‰æ–¼ç™‚æ•ˆä¿è­‰ã€‚`;

                addDebugLog('ç™¼é€æ¨è–¦è«‹æ±‚');
                
                const result = await window.Poe.sendUserMessage(prompt, {
                    handler: "product-recommendations",
                    stream: true,
                    openChat: false
                });
                
                addDebugLog('æ¨è–¦è«‹æ±‚æˆåŠŸç™¼é€', result);
                
                // Set a timeout in case handler doesn't get called
                setTimeout(() => {
                    if (this.disabled) {
                        showError('æ¨è–¦è«‹æ±‚è¶…æ™‚ï¼Œè«‹é‡è©¦');
                        resetRecommendButton();
                    }
                }, 60000); // 60 second timeout
                
            } catch (err) {
                console.error('Error during recommendation:', err);
                addDebugLog('æ¨è–¦è«‹æ±‚éŒ¯èª¤', err);
                
                let errorMsg = "ç²å–æ¨è–¦æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š";
                
                if (err.errorType) {
                    switch(err.errorType) {
                        case "USER_REJECTED_CONFIRMATION":
                            errorMsg += "ç”¨æˆ¶å–æ¶ˆäº†ç¢ºèªå°è©±æ¡†";
                            break;
                        case "INVALID_INPUT":
                            errorMsg += "è¼¸å…¥ç„¡æ•ˆ";
                            break;
                        case "ANOTHER_CONFIRMATION_IS_OPEN":
                            errorMsg += "å¦ä¸€å€‹ç¢ºèªå°è©±æ¡†å·²é–‹å•Ÿ";
                            break;
                        default:
                            errorMsg += err.message || "æœªçŸ¥éŒ¯èª¤";
                    }
                } else {
                    errorMsg += err.message || "æœªçŸ¥éŒ¯èª¤";
                }
                
                showError(errorMsg);
                resetRecommendButton();
            }
        });

        function resetRecommendButton() {
            const recommendBtn = document.getElementById('recommendBtn');
            recommendBtn.disabled = false;
            recommendBtn.textContent = 'ğŸ’Š ç²å–ç‡Ÿé¤Šç”¢å“æ¨è–¦';
        }

        function parseAndDisplayRecommendations(content) {
            addDebugLog('è§£ææ¨è–¦çµæœ', { contentLength: content.length });
            
            // Show recommendations section
            const productRecommendationsSection = document.getElementById('productRecommendationsSection');
            document.getElementById('productRecommendations').innerHTML = marked.parse(content);
            productRecommendationsSection.classList.remove('hidden');
            
            // Hide other sections for recommendation-only results
            document.getElementById('personalSuitabilitySection').classList.add('hidden');
            
            resultsSection.classList.remove('hidden');
        }

        // Reset button
        resetBtn.addEventListener('click', function() {
            selectedFile = null;
            imageInput.value = '';
            imagePreview.classList.add('hidden');
            analyzeBtn.classList.add('hidden');
            hideLoading();
            hideError();
            hideResults();
        });

        function showLoading() {
            loadingState.classList.remove('hidden');
        }

        function hideLoading() {
            loadingState.classList.add('hidden');
        }

        function showError(message, details = null) {
            addDebugLog('é¡¯ç¤ºéŒ¯èª¤', { message, details });
            errorMessage.textContent = message;
            
            if (details) {
                const errorDetails = document.getElementById('errorDetails');
                errorDetails.textContent = details;
                errorDetails.classList.remove('hidden');
            }
            
            errorState.classList.remove('hidden');
            hideLoading();
        }

        function hideError() {
            errorState.classList.add('hidden');
        }

        function hideResults() {
            resultsSection.classList.add('hidden');
        }

        function parseAndDisplayResults(content) {
            // Parse the markdown content and extract sections
            const sections = {
                personal: '',
                analysis: '',
                benefits: '',
                dosage: '',
                safety: ''
            };

            // Split content by headers
            const lines = content.split('\n');
            let currentSection = '';
            
            for (let line of lines) {
                if (line.includes('å€‹äººåŒ–é©ç”¨æ€§è©•ä¼°') || line.includes('é©ç”¨æ€§è©•ä¼°')) {
                    currentSection = 'personal';
                    continue;
                } else if (line.includes('ç‡Ÿé¤Šæˆåˆ†åˆ†æ') || line.includes('æˆåˆ†åˆ†æ')) {
                    currentSection = 'analysis';
                    continue;
                } else if (line.includes('ç‡Ÿé¤Šç´ åŠŸæ•ˆ') || line.includes('åŠŸæ•ˆ')) {
                    currentSection = 'benefits';
                    continue;
                } else if (line.includes('å»ºè­°æ”å–é‡') || line.includes('æ”å–é‡') || line.includes('ç”¨æ³•')) {
                    currentSection = 'dosage';
                    continue;
                } else if (line.includes('æ³¨æ„äº‹é …') || line.includes('å‰¯ä½œç”¨') || line.includes('ç¦å¿Œ')) {
                    currentSection = 'safety';
                    continue;
                }
                
                if (currentSection && line.trim()) {
                    sections[currentSection] += line + '\n';
                }
            }

            // If sections are not clearly divided, show all content in analysis section
            if (!sections.analysis && !sections.benefits && !sections.dosage && !sections.safety && !sections.personal) {
                sections.analysis = content;
            }

            // Show/hide personal suitability section based on content
            const personalSuitabilitySection = document.getElementById('personalSuitabilitySection');
            if (sections.personal && sections.personal.trim()) {
                document.getElementById('personalSuitability').innerHTML = marked.parse(sections.personal);
                personalSuitabilitySection.classList.remove('hidden');
            } else {
                personalSuitabilitySection.classList.add('hidden');
            }

            // Convert markdown to HTML and display other sections
            document.getElementById('nutritionalAnalysis').innerHTML = marked.parse(sections.analysis || 'æœªæ‰¾åˆ°ç‡Ÿé¤Šæˆåˆ†è³‡è¨Š');
            document.getElementById('healthBenefits').innerHTML = marked.parse(sections.benefits || 'æœªæ‰¾åˆ°åŠŸæ•ˆè³‡è¨Š');
            document.getElementById('dosageRecommendations').innerHTML = marked.parse(sections.dosage || 'æœªæ‰¾åˆ°æ”å–é‡å»ºè­°');
            document.getElementById('safetyInfo').innerHTML = marked.parse(sections.safety || 'æœªæ‰¾åˆ°æ³¨æ„äº‹é …');

            resultsSection.classList.remove('hidden');
        }
    </script>
</body>
</html>
Commit message: Add nutrition analyzer application
   - Description: Complete HTML app with AI features
